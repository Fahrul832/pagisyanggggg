<!doctype html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Mekar Pagi Fani üå∏</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Quicksand:wght@500&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        margin: 0;
        overflow: hidden;
        background: linear-gradient(
          to bottom,
          #ff9a9e 0%,
          #fad0c4 50%,
          #ffd1ff 100%
        ); /* Gradasi Fajar */
        font-family: "Quicksand", sans-serif;
        touch-action: none;
        transition: background 5s ease;
      }
      body.morning {
        background: linear-gradient(
          to bottom,
          #89f7fe 0%,
          #66a6ff 100%
        ); /* Gradasi Pagi Cerah */
      }

      canvas {
        display: block;
      }

      /* UI LAYER */
      #ui-container {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }

      #instruction {
        position: absolute;
        bottom: 50px;
        color: #fff;
        font-size: 1.2rem;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        animation: pulse 2s infinite;
        opacity: 1;
        transition: opacity 1s;
      }

      /* KARTU UCAPAN AKHIR */
      .card {
        background: rgba(255, 255, 255, 0.95);
        padding: 40px;
        border-radius: 30px;
        text-align: center;
        width: 85%;
        max-width: 400px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
        pointer-events: auto;
        opacity: 0;
        transform: scale(0.8) translateY(50px);
        transition: all 1s cubic-bezier(0.19, 1, 0.22, 1);
      }
      .card.show {
        opacity: 1;
        transform: scale(1) translateY(0);
      }

      h1 {
        font-family: "Dancing Script", cursive;
        color: #ff6b81;
        font-size: 3rem;
        margin: 0 0 10px;
      }
      p {
        color: #555;
        font-size: 1.1rem;
        line-height: 1.6;
        margin-bottom: 30px;
      }

      .btn-wa {
        background: linear-gradient(45deg, #ff6b81, #ff9f43);
        color: white;
        text-decoration: none;
        padding: 15px 40px;
        border-radius: 50px;
        font-weight: bold;
        font-size: 1.1rem;
        display: inline-block;
        box-shadow: 0 10px 20px rgba(255, 107, 129, 0.4);
        transition: transform 0.2s;
      }
      .btn-wa:active {
        transform: scale(0.95);
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 0.6;
        }
        50% {
          opacity: 1;
        }
      }
    </style>
  </head>
  <body>
    <canvas id="canvas"></canvas>

    <div id="ui-container">
      <div id="instruction">Ketuk layar untuk menyiram bunga üíß</div>

      <div class="card" id="endCard">
        <h1>Selamat Pagi Fani</h1>
        <p>
          Lihat, bunganya mekar indah sekali.<br />
          Semoga harimu juga berjalan indah dan mekar seperti bunga ini ya.<br />
          Semangat sayang! ‚ù§Ô∏è
        </p>
        <a
          href="https://wa.me/62895622188096?text=Cantik%20banget%20bunganya%20mekar!%20Makasih%20ucapan%20paginya%20sayang%20%F0%9F%8C%B8%E2%98%80%EF%B8%8F"
          class="btn-wa"
        >
          Peluk Fahrul ü§ó
        </a>
      </div>
    </div>

    <script>
      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d");
      let width, height;

      // Config
      let progress = 0; // 0 sampai 1 (1 = mekar sempurna)
      const TOTAL_TAPS_NEEDED = 50;
      let tapCount = 0;
      let isFinished = false;

      // Objects
      let waterParticles = [];
      let bloomParticles = [];
      let sunY = 0;

      function resize() {
        width = canvas.width = window.innerWidth;
        height = canvas.height = window.innerHeight;
        sunY = height * 0.8; // Matahari mulai dari bawah
      }
      window.addEventListener("resize", resize);
      resize();

      // --- INPUT ---
      function handleTap(e) {
        if (isFinished) return;

        tapCount++;
        // Progress berjalan mulus (easing)
        let targetProgress = Math.min(1, tapCount / TOTAL_TAPS_NEEDED);
        progress += (targetProgress - progress) * 0.1;

        // Buat partikel air di posisi tap
        let x = e.clientX || e.touches[0].clientX;
        let y = e.clientY || e.touches[0].clientY;
        createWater(x, y);

        // Sembunyikan instruksi setelah beberapa tap
        if (tapCount > 5)
          document.getElementById("instruction").style.opacity = 0;

        // Cek Selesai
        if (progress >= 0.99 && !isFinished) {
          finish();
        }
      }
      window.addEventListener("mousedown", handleTap);
      window.addEventListener("touchstart", handleTap, { passive: false });

      // --- DRAWING FUNCTIONS ---

      function drawSun() {
        // Matahari terbit seiring progress
        let targetSunY = height * 0.2;
        sunY = height * 0.8 - height * 0.6 * progress;

        const gradient = ctx.createRadialGradient(
          width / 2,
          sunY,
          10,
          width / 2,
          sunY,
          200,
        );
        gradient.addColorStop(0, "rgba(255, 255, 200, 1)");
        gradient.addColorStop(0.2, "rgba(255, 220, 100, 0.8)");
        gradient.addColorStop(1, "rgba(255, 220, 100, 0)");

        ctx.fillStyle = gradient;
        ctx.beginPath();
        ctx.arc(width / 2, sunY, 200, 0, Math.PI * 2);
        ctx.fill();
      }

      function drawStem(growFactor) {
        // Gambar Batang yang tumbuh
        const startX = width / 2;
        const startY = height;
        const endY = height - height * 0.5 * growFactor;

        ctx.beginPath();
        ctx.moveTo(startX, startY);
        // Kurva bezier agar batang terlihat alami meliuk
        ctx.quadraticCurveTo(
          startX + 20 * growFactor,
          startY - (startY - endY) / 2,
          startX,
          endY,
        );

        ctx.lineWidth = 15 * growFactor;
        ctx.strokeStyle = "#6ab04c"; // Hijau segar
        ctx.lineCap = "round";
        ctx.stroke();

        // Daun (muncul saat setengah tumbuh)
        if (growFactor > 0.3) {
          drawLeaf(startX, startY - (startY - endY) * 0.4, -1, growFactor);
        }
        if (growFactor > 0.6) {
          drawLeaf(startX, startY - (startY - endY) * 0.7, 1, growFactor);
        }
      }

      function drawLeaf(x, y, dir, growFactor) {
        const size = 40 * growFactor;
        ctx.save();
        ctx.translate(x, y);
        ctx.rotate(dir * 0.5);
        ctx.beginPath();
        ctx.ellipse(dir * size, 0, size, size / 2, 0, 0, Math.PI * 2);
        ctx.fillStyle = "#badc58";
        ctx.fill();
        ctx.restore();
      }

      function drawFlower(growFactor) {
        const centerX = width / 2;
        const centerY = height - height * 0.5 * growFactor;
        // Ukuran bunga berdasarkan progress. Menggunakan fungsi 'pow' agar mekarnya dramatis di akhir.
        const bloomSize = Math.pow(growFactor, 3) * (width < 500 ? 100 : 150);

        if (bloomSize < 5) return; // Belum muncul

        ctx.save();
        ctx.translate(centerX, centerY);

        // Gambar Kelopak (Petals)
        const petals = 8;
        for (let i = 0; i < petals; i++) {
          ctx.save();
          const angle = ((Math.PI * 2) / petals) * i;
          ctx.rotate(angle);

          // Warna gradasi kelopak (Pink ke Putih)
          const grad = ctx.createLinearGradient(0, 0, bloomSize, 0);
          grad.addColorStop(0, "#ff7675");
          grad.addColorStop(1, "#ffeaa7");

          ctx.beginPath();
          // Bentuk kelopak menggunakan kurva
          ctx.moveTo(0, 0);
          ctx.quadraticCurveTo(bloomSize / 2, bloomSize / 2, bloomSize, 0);
          ctx.quadraticCurveTo(bloomSize / 2, -bloomSize / 2, 0, 0);

          ctx.fillStyle = grad;
          // Shadow halus agar terlihat 3D/timbul
          ctx.shadowColor = "rgba(255,100,100,0.3)";
          ctx.shadowBlur = 10;
          ctx.fill();
          ctx.restore();
        }

        // Pusat Bunga
        ctx.beginPath();
        ctx.arc(0, 0, bloomSize / 4, 0, Math.PI * 2);
        ctx.fillStyle = "#fdcb6e";
        ctx.fill();

        ctx.restore();
      }

      // --- PARTICLES SYSTEM ---
      function createWater(x, y) {
        for (let i = 0; i < 5; i++) {
          waterParticles.push({
            x: x,
            y: y,
            vx: (Math.random() - 0.5) * 5,
            vy: Math.random() * 5,
            life: 1,
            size: Math.random() * 5 + 2,
          });
        }
      }

      function createBloomParticles() {
        const centerX = width / 2;
        const centerY = height - height * 0.5;
        for (let i = 0; i < 50; i++) {
          const angle = Math.random() * Math.PI * 2;
          const speed = Math.random() * 5 + 2;
          bloomParticles.push({
            x: centerX,
            y: centerY,
            vx: Math.cos(angle) * speed,
            vy: Math.sin(angle) * speed,
            life: 1,
            size: Math.random() * 8 + 4,
            color: Math.random() > 0.5 ? "#ffeaa7" : "#ff7675",
          });
        }
      }

      function updateAndDrawParticles() {
        // Water
        for (let i = waterParticles.length - 1; i >= 0; i--) {
          let p = waterParticles[i];
          p.x += p.vx;
          p.y += p.vy;
          p.life -= 0.03;
          ctx.globalAlpha = p.life;
          ctx.fillStyle = "#74b9ff";
          ctx.beginPath();
          ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
          ctx.fill();
          if (p.life <= 0) waterParticles.splice(i, 1);
        }
        // Bloom Sparkles
        for (let i = bloomParticles.length - 1; i >= 0; i--) {
          let p = bloomParticles[i];
          p.x += p.vx * 0.98;
          p.y += p.vy * 0.98 + 0.1;
          p.life -= 0.02; // Ada gravitasi sedikit
          ctx.globalAlpha = p.life;
          ctx.fillStyle = p.color;
          ctx.beginPath();
          // Gambar bentuk bintang/kilau sederhana
          ctx.moveTo(p.x, p.y - p.size);
          ctx.lineTo(p.x + p.size / 2, p.y);
          ctx.lineTo(p.x, p.y + p.size);
          ctx.lineTo(p.x - p.size / 2, p.y);
          ctx.fill();
          if (p.life <= 0) bloomParticles.splice(i, 1);
        }
        ctx.globalAlpha = 1;
      }

      // --- MAIN LOOP ---
      function loop() {
        ctx.clearRect(0, 0, width, height);

        // Smooth progress
        let target = Math.min(1, tapCount / TOTAL_TAPS_NEEDED);
        progress += (target - progress) * 0.05;

        drawSun();
        drawStem(progress);
        drawFlower(progress);
        updateAndDrawParticles();

        requestAnimationFrame(loop);
      }

      function finish() {
        isFinished = true;
        progress = 1;
        document.body.classList.add("morning"); // Ubah warna langit jadi pagi cerah
        createBloomParticles(); // Efek ledakan partikel
        setTimeout(() => {
          document.getElementById("endCard").classList.add("show");
        }, 1500);
      }

      loop();
    </script>
  </body>
</html>
